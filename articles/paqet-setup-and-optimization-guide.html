<!DOCTYPE html>
<html lang="en">

<!-- https://github.com/FaridZelli -->

<!-- Head -->

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="darkreader-lock">

    <link rel="canonical" href="https://faridzelli.com/articles/articles/paqet-setup-and-optimization-guide.html">
    <link rel="icon" href="/media/favicon.svg" type="image/svg+xml">

    <title>Paqet basics, server–client setup and KCP optimization guide</title>

    <meta name="description" content="Explore the inner workings of hanselime/paqet and learn how to set up KCP for optimal performance.">

    <meta name="language" content="en">
    <meta name="author" content="Farid Zelli">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Paqet basics, server–client setup and KCP optimization guide">
    <meta property="og:description" content="Explore the inner workings of hanselime/paqet and learn how to set up KCP for optimal performance.">
    <meta property="og:url" content="https://faridzelli.com/articles/articles/paqet-setup-and-optimization-guide.html">
    <meta property="og:site_name" content="Farid Zelli">

    <meta property="article:published_time" content="Fri Feb 20 2026 03:30:00 GMT+0330 (Iran Standard Time)">
    <meta property="article:modified_time" content="Fri Feb 20 2026 03:30:00 GMT+0330 (Iran Standard Time)">

    <meta name="twitter:title" content="Paqet basics, server–client setup and KCP optimization guide">
    <meta name="twitter:description" content="Explore the inner workings of hanselime/paqet and learn how to set up KCP for optimal performance.">
    <meta name="twitter:creator" content="@faridzelli">

    <link rel="stylesheet" href="/github-markdown.css">
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/style-article.css">
</head>

<body>

    <script src="/external-links.js"></script>
    <script src="/dynamic-shapes-article.js"></script>
    <script type="module" src="/article-utils.js"></script>

<!-- Header -->

    <header>
        <div class="basic-container">
            <h1 class="logo"><a href="/" aria-label="Go to homepage">Farid Zelli</a></h1>
            <nav>
                <ul>
                    <li><a href="/articles/" aria-label="View articles">Articles</a></li>
                    <li><a href="/about/" aria-label="Learn more about the author">About Me</a></li>
                </ul>
            </nav>
        </div>
    </header>

<!-- Main -->

    <main>
        <section id="hero">
            <div class="svg-shapes"></div>
            <div class="basic-container">
                <div class="red-rectangle">
                    <div class="red-rectangle-content">
                        <h1>Meet Paqet: the basics, server–client setup and KCP optimization guide.</h1>
                    </div>
                </div>
            </div>
        </section>

        <article id="content" class="markdown-body">
            <div class="article-container">
                <blockquote>
                <p id="tz-para" style="display:none" dir="rtl">ⓘ منطقۀ زمانی شما «ساعت رسمی ایران» است.<br>
هم‌میهن گرامی، مقالات به دلیل محدودیت زمانی تنها به زبان انگلیسی منتشر می‌شوند. توصیه می‌کنم برای ترجمه از هوش مصنوعی استفاده کنید.
                </blockquote>
                </p>
                <script>
                document.addEventListener('DOMContentLoaded', () => {
                if (document.getElementById('disable-tz-message')) return;
                const TARGET = 'Asia/Tehran';
                try {
                    const userTz = Intl.DateTimeFormat().resolvedOptions().timeZone;
                    if (userTz === TARGET) {
                    document.getElementById('tz-para').style.display = 'block';
                    }
                } catch (e) {
                    console.warn('Timezone detection failed; content remains hidden', e);
                }
                });
                </script>
                <ul id="article-date"></ul>

                <p><a href="https://github.com/hanselime/paqet"><code>paqet</code></a> is a new low-level proxy utility designed to bypass highly restrictive firewalls. The project revolves around the concept of raw sockets, drawing inspiration from <a href="https://github.com/GFW-knocker/gfw_resist_tcp_proxy"><code>gfw_resist_tcp_proxy</code></a>.</p>
<p>The two projects differ in several key ways:</p>
<table>
<thead>
<tr>
<th></th>
<th>paqet</th>
<th>gfw_resist_tcp_proxy</th>
</tr>
</thead>
<tbody><tr>
<td>Packet manipulation method</td>
<td>RAW sockets</td>
<td>TCP violation</td>
</tr>
<tr>
<td>Transport protocol</td>
<td>KCP</td>
<td>QUIC</td>
</tr>
<tr>
<td>Bypasses blocked ports</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Resource usage</td>
<td>Low</td>
<td>High</td>
</tr>
</tbody></table>
<p>This article will focus on setting up Paqet manually for optimal performance on low-end hardware.</p>
<h1>Setting Up Paqet</h1>
<blockquote>
<p>Note: the following information is based on <code>v1.0.0-alpha.17</code> at the time of writing this article.</p>
</blockquote>
<p>Binaries are located at <a href="https://github.com/hanselime/paqet">hanselime/paqet/releases</a>. Paqet ships a unified executable for both servers and clients.
Setup instructions are available on the repository: <a href="https://github.com/hanselime/paqet?tab=readme-ov-file#getting-started">Getting Started</a></p>
<h1>Different Ways To Use Paqet</h1>
<p>You should now have a functional local proxy running on 127.0.0.1:1080 which is directing traffic to your server.</p>
<h2>Sharing with other devices</h2>
<p>It is possible to route traffic from other devices on your home network through the Paqet client by changing the local proxy address to your device&#39;s IP address. In the following example, we will connect to our Packet client using <a href="https://orbot.app/en/">Orbot</a> on a phone.</p>
<p>client.yaml</p>
<pre><code># SOCKS5 proxy configuration (client mode)
socks5:
  - listen: &quot;192.168.1.2:1080&quot;    # SOCKS5 proxy listen address
    username: &quot;&quot;                # Optional SOCKS5 authentication
    password: &quot;&quot;                # Optional SOCKS5 authentication
</code></pre>
<p>Orbot Outbound Network Proxy:</p>
<pre><code>Outnound proxy type: SOCKS5
Outbound proxy host: 192.168.1.2
Outbound proxy port: 1080
</code></pre>
<h2>Creating a tunnel interface</h2>
<p>You can create a tunnel interface from any local proxy using a tun2socks utility such as <a href="https://github.com/heiher/hev-socks5-tunnel"><code>hev-socks5-tunnel</code></a>. To proceed, download the latest binary and configure <code>hev-socks5-tunnel</code> as follows:</p>
<p>main.yaml</p>
<pre><code>tunnel:
  # Interface name
  name: tun0
  # Interface MTU
  mtu: 8500
  # Multi-queue
  multi-queue: false
  # IPv4 address
  ipv4: 198.18.0.1
  # IPv6 address
#  ipv6: &#39;fc00::1&#39;
  # Post up script
# post-up-script: up.sh
  # Pre down script
# pre-down-script: down.sh

socks5:
  # Socks5 server port
  port: 1080
  # Socks5 server address (ipv4/ipv6)
  address: 127.0.0.1
  # Socks5 UDP relay mode (tcp|udp)
  udp: &#39;udp&#39;
  # Override the UDP address provided by the Socks5 server (ipv4/ipv6)
# udp-address: &#39;&#39;
  # Socks5 handshake using pipeline mode
# pipeline: false
  # Socks5 server username
# username: &#39;username&#39;
  # Socks5 server password
# password: &#39;password&#39;
  # Socket mark
mark: 438
</code></pre>
<p>Run <code>hev-socks5-tunnel</code>:</p>
<pre><code># Set socks5.mark = 438
sudo hev-socks5-tunnel main.yaml

# Disable reverse path filter
sudo sysctl -w net.ipv4.conf.all.rp_filter=0
sudo sysctl -w net.ipv4.conf.tun0.rp_filter=0

# Bypass upstream socks5 server
sudo ip rule add fwmark 438 lookup main pref 10
sudo ip -6 rule add fwmark 438 lookup main pref 10

# Route others
sudo ip route add default dev tun0 table 20
sudo ip rule add lookup 20 pref 20
sudo ip -6 route add default dev tun0 table 20
sudo ip -6 rule add lookup 20 pref 20
</code></pre>
<h2>Routing traffic from a shared interface through the tunnel</h2>
<p>To route incoming traffic from an interface called <code>eth1</code> through the tunnel, make the following changes:</p>
<pre><code># Set socks5.mark = 438
sudo hev-socks5-tunnel main.yaml

# Disable reverse path filter
sudo sysctl -w net.ipv4.conf.all.rp_filter=0
sudo sysctl -w net.ipv4.conf.tun0.rp_filter=0
sudo sysctl -w net.ipv4.conf.eth1.rp_filter=0

# Bypass upstream socks5 server
sudo ip rule add fwmark 438 lookup main pref 10
sudo ip -6 rule add fwmark 438 lookup main pref 10

# Route others
sudo ip route add default dev tun0 table 20
sudo ip rule add iif eth1 lookup 20 pref 20
sudo ip -6 route add default dev tun0 table 20
sudo ip -6 rule add iif eth1 lookup 20 pref 20
</code></pre>
<h1>Optimizing KCP For Maximum Throughput</h1>
<img src="/content/paqet-setup-and-optimization-guide/2026-02-18-cloudflare-screenshot.png" alt="Cloudflare Speed Test">

<p>Paqet&#39;s configuration file exposes advanced KCP parameters. We&#39;ll go through the most important ones:</p>
<p><strong>conn</strong> :
Number of KCP connections. For a low performance single-core server, leave at <code>1</code>. Buffer sizes should be increased relative to the number of connections. Performance scales with higher values on capable hardware.</p>
<p><strong>mode</strong> :
Predefined presets for KCP. Switch to <code>manual</code> for the following settings to take effect.</p>
<p><strong>interval</strong> :
Internal update timer interval in milliseconds. There&#39;s really no reason to change this under most circumstances.</p>
<p><strong>resend</strong> :
Packet retransmission trigger. Leave at <code>2</code>. However, stable networks may benefit from changing this to <code>0</code>.</p>
<p><strong>nocongestion</strong> :
Disables congestion control. Set to <code>1</code>.</p>
<p><strong>wdelay</strong> :
Enables write batching. Set to <code>true</code> for most use cases.</p>
<p><strong>acknodelay</strong> :
Disables ACK batching. Set to <code>false</code> for most use cases.</p>
<p><strong>mtu</strong> :
Maximum MTU size used by KCP. Set this to the highest possible value for your network.  </p>
<blockquote>
<p>Real-world example for a PPPoE connection with an MTU size of 1492:  </p>
<blockquote>
<p>IP header: 20 bytes<br>UDP header: 8 bytes<br>KCP header: 24 bytes<br>1492 - 52 = <strong>1440</strong>  </p>
</blockquote>
</blockquote>
<p><strong>rcvwnd/sndwnd</strong> :
Larger window sizes allow for more in-flight data. Set to <code>1024</code> for most use cases. Higher values may consume more memory and potentially cause stability issues over sub-optimal network conditions.</p>
<p><strong>block</strong> :
Encryption standard used by KCP. Use <code>xor</code> (insecure algorithm, serves as basic authentication) if already tunneling encrypted traffic (e.g. WireGuard) through Paqet.  </p>
<blockquote>
<p>While more secure, performance-friendly algorithms such as <code>aes-128-gcm</code> and <code>salsa20</code> are supported, Paqet should not be used for security-sensitive applications as it has not yet been audited at the time of writing.</p>
</blockquote>
<p><strong>smuxbuf</strong> :
This is the aggregate read buffer for the entire SMUX multiplexer. Should be slightly higher than the size of the stream buffer, multiplied by the number of connections.</p>
<p><strong>streambuf</strong> :
Buffer size per KCP connection. Recommended value is <code>8388608</code> (8MB) for a typical 200 Mbps connection.</p>
<h2>Example configuration file</h2>
<pre><code># Transport protocol configuration
transport:
  protocol: &quot;kcp&quot;  # Transport protocol (currently only &quot;kcp&quot; supported)
  conn: 1          # Number of connections (1-256, default: 1)

  # tcpbuf: 8192   # TCP buffer size in bytes
  # udpbuf: 4096   # UDP buffer size in bytes

  # KCP protocol settings
  kcp:
    mode: &quot;manual&quot;              # KCP mode: normal, fast, fast2, fast3, manual

    # Manual mode parameters (only used when mode=&quot;manual&quot;)
    nodelay: 1              # 0=disable, 1=enable
                              # Enable for lower latency &amp; aggressive retransmission
                              # Disable for TCP-like conservative behavior

    interval: 10            # Internal update timer interval in milliseconds (10-5000ms)
                              # Lower values increase responsiveness but raise CPU usage

    resend: 2               # Fast retransmit trigger (0-2)
                              # 0 = disabled (wait for timeout only)
                              # 1 = most aggressive (retransmit after 1 ACK skip)
                              # 2 = aggressive (retransmit after 2 ACK skips)

    nocongestion: 1         # Congestion control: 0=enabled, 1=disabled
                              # 0 = TCP-like fair congestion control (slow start, congestion avoidance)
                              # 1 = disable congestion control for maximum speed

    wdelay: true           # Write batching behavior
                              # false = flush immediately (low latency, recommended for real-time)
                              # true = batch writes until next update interval (higher throughput)
                              # Controls when data is actually sent to the network

    acknodelay: false        # ACK sending behavior
                              # true = send ACKs immediately when packets are received (lower latency)
                              # false = batch ACKs (more bandwidth efficient)
                              # Setting true reduces latency but increases bandwidth usage

    mtu: 1440              # Maximum transmission unit (50-1500)
    rcvwnd: 1024           # Receive window size (default for server)
    sndwnd: 1024           # Send window size (default for server)

    # Encryption settings
    block: &quot;xor&quot;                    # Encryption: aes, aes-128, aes-128-gcm, aes-192, salsa20, blowfish, twofish, cast5, 3des, tea, xtea, xor, sm4, none, null.
    key: &quot;your-secret-key-here&quot;       # CHANGE ME: Secret key (must match client)

    # Buffer settings (optional)
    smuxbuf: 16777216       # 16MB SMUX buffer
    streambuf: 8388608     # 8MB stream buffer
</code></pre>
            </div>
        </article>
    </main>

<!-- Footer -->

    <footer>
        <div class="basic-container">
                <ul class="social-links">
                    <li class="icon-content">
                        <a href="https://github.com/FaridZelli" target="_blank" rel="noopener noreferrer" aria-label="GitHub" data-social="GitHub">
                            <div class="filled"></div>
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-github"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" /></svg>
                        </a>
                        <div class="tooltip">GitHub</div>
                    </li>
                    <li class="icon-content">
                        <a href="https://linkedin.com/in/faridzellipour" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn" data-social="LinkedIn">
                            <div class="filled"></div>
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-linkedin"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 11v5" /><path d="M8 8v.01" /><path d="M12 16v-5" /><path d="M16 16v-3a2 2 0 1 0 -4 0" /><path d="M3 7a4 4 0 0 1 4 -4h10a4 4 0 0 1 4 4v10a4 4 0 0 1 -4 4h-10a4 4 0 0 1 -4 -4z" /></svg>
                        </a>
                        <div class="tooltip">LinkedIn</div>
                    </li>
                    <li class="icon-content">
                        <a href="https://www.youtube.com/@FaridZelli" target="_blank" rel="noopener noreferrer" aria-label="YouTube" data-social="YouTube">
                            <div class="filled"></div>
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-youtube"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M2 8a4 4 0 0 1 4 -4h12a4 4 0 0 1 4 4v8a4 4 0 0 1 -4 4h-12a4 4 0 0 1 -4 -4v-8z" /><path d="M10 9l5 3l-5 3z" /></svg>
                        </a>
                        <div class="tooltip">YouTube</div>
                    </li>
                    <li class="icon-content">
                        <a href="https://www.instagram.com/faridzelli" target="_blank" rel="noopener noreferrer" aria-label="Instagram" data-social="Instagram">
                            <div class="filled"></div>
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-instagram"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 8a4 4 0 0 1 4 -4h8a4 4 0 0 1 4 4v8a4 4 0 0 1 -4 4h-8a4 4 0 0 1 -4 -4z" /><path d="M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0" /><path d="M16.5 7.5v.01" /></svg>
                        </a>
                        <div class="tooltip">Instagram</div>
                    </li>
                    <li class="icon-content">
                        <a href="https://www.x.com/faridzelli" target="_blank" rel="noopener noreferrer" aria-label="Twitter" data-social="Twitter">
                            <div class="filled"></div>
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-twitter"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c0 -.249 1.51 -2.772 1.818 -4.013z" /></svg>
                        </a>
                        <div class="tooltip">Twitter</div>
                    </li>
                    <li class="icon-content">
                        <a href="https://t.me/PureSoftware/80" target="_blank" rel="noopener noreferrer" aria-label="Telegram" data-social="Telegram">
                            <div class="filled"></div>
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-telegram"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 10l-4 4l6 6l4 -16l-18 7l4 2l2 6l3 -4" /></svg>
                        </a>
                        <div class="tooltip">Ruche d’État</div>
                    </li>
                </ul>
                <div class="email-list">
                    <a href="mailto:faridzelli@gmail.com" class="email-item">faridzelli@gmail.com</a>
                    <a href="mailto:faridzelli@proton.me" class="email-item">faridzelli@proton.me</a>
                </div>
                <p class="footer-copyright">&copy; 2025–2026 Farid Zellipour. All rights reserved.<br>This website does not use cookies.<br>(or biscuits, if you may)</p>
        </div>
    </footer>

</body>

</html>
